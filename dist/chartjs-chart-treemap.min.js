/*!
 * chartjs-chart-treemap v0.2.0
 * https://github.com/kurkle/chartjs-chart-treemap#readme
 * (c) 2019 Jukka Kurkela
 * Released under the MIT license
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("chart.js")):"function"==typeof define&&define.amd?define(["chart.js"],e):e((t=t||self).Chart)}(this,function(t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var e={flatten:function(t){const e=[...t],r=[];for(;e.length;){const t=e.pop();Array.isArray(t)?e.push(...t):r.push(t)}return r.reverse()},group:function(t,e,r,n,i){var a,s,o,h,u=Object.create(null),l=[];for(s=0,o=t.length;s<o;++s)h=t[s],n&&h[n]!==i||((a=h[e]||"")in u||(u[a]=0),u[a]+=+h[r]);return Object.keys(u).forEach(function(t){(h={})[r]=+u[t],h[e]=t,n&&(h[n]=i),l.push(h)}),l},sort:function(t,e){e?t.sort(function(t,r){return+r[e]-+t[e]}):t.sort(function(t,e){return+e-+t})},sum:function(t,e){var r,n,i;for(r=0,n=0,i=t.length;n<i;++n)r+=e?+t[n][e]:+t[n];return r}};function r(t,e){return+(Math.round(t+"e+"+e)+"e-"+e)}function n(t,e,r,n){var i=t._normalized,a=e*i/r,s=Math.sqrt(i*a),o=i/s;return{d1:s,d2:o,w:"_ix"===n?s:o,h:"_ix"===n?o:s}}function i(t,e,n,i){var a={x:r(t.x+t._ix,4),y:r(t.y+t._iy,4),w:r(n.w,4),h:r(n.h,4),a:e._normalized,v:e.value,s:i};return e.group&&(a.g=e.group,a.l=e.level,a.gs=e.groupSum),a}class a{constructor(t){var e=this;e.x=t.x||t.left||0,e.y=t.y||t.top||0,e._ix=0,e._iy=0,e.w=t.w||t.width||t.right-t.left,e.h=t.h||t.height||t.bottom-t.top}get area(){return this.w*this.h}get iw(){return this.w-this._ix}get ih(){return this.h-this._iy}get dir(){var t=this.ih;return t<=this.iw&&t>0?"y":"x"}get side(){return"x"===this.dir?this.iw:this.ih}map(t){var e,r,a,s=this,o=[],h=t.nsum,u=t.get(),l=u.length,d=s.dir,p=s.side,c=p*p,m="x"===d?"_ix":"_iy",g=h*h,f=0,x=0;for(e=0;e<l;++e)x+=(a=n(r=u[e],c,g,m)).d1,a.d2>f&&(f=a.d2),o.push(i(s,r,a,t.sum)),s[m]+=a.d1;return s["y"===d?"_ix":"_iy"]+=f,s[m]-=x,o}}const s=Math.min,o=Math.max;function h(t,e){var r=+e[t.key],n=r*t.ratio;return e._normalized=n,{min:s(t.min,r),max:o(t.max,r),sum:t.sum+r,nmin:s(t.nmin,n),nmax:o(t.nmax,n),nsum:t.nsum+n}}function u(t,e,r){t._arr.push(e),function(t,e){Object.assign(t,e)}(t,r)}class l{constructor(t,e){this.key=t,this.ratio=e,this.reset()}get length(){return this._arr.length}reset(){var t=this;t._arr=[],t._hist=[],t.sum=0,t.nsum=0,t.min=1/0,t.max=-1/0,t.nmin=1/0,t.nmax=-1/0}push(t){u(this,t,h(this,t))}pushIf(t,e,...r){var n,i=h(this,t);if(!e((n=this,{min:n.min,max:n.max,sum:n.sum,nmin:n.nmin,nmax:n.nmax,nsum:n.nsum}),i,r))return t;u(this,t,i)}get(){return this._arr}}function d(t,e,r){if(0===t.sum)return!0;var[n]=r,i=t.nsum*t.nsum,a=e.nsum*e.nsum,s=n*n,o=Math.max(s*t.nmax/i,i/(s*t.nmin));return Math.max(s*e.nmax/a,a/(s*e.nmin))<=o}function p(t,r,n,i,s,o){var h,u,p,c=e.sum(t,n),m=[],g=new a(r),f=new l("value",g.area/c),x=g.side,y=t.length;if(!y)return m;function v(e){return i&&t[e][i]}for(t=t.slice(),e.sort(t,n),h=0;h<y;++h)u={value:(p=h,n?+t[p][n]:+t[p]),groupSum:o},i&&(u.level=s,u.group=v(h)),(u=f.pushIf(u,d,x))&&(m.push(g.map(f)),x=g.side,f.reset(),f.push(u));return f.length&&m.push(g.map(f)),e.flatten(m)}var c=t.helpers.options.resolve;var m=t.DatasetController.extend({dataElementType:t.elements.Rectangle,update:function(t){var r,n,i,a,s,o=this,h=o.getMeta(),u=o.getDataset(),l=h.data||[],d=o.chart.chartArea;for(i={x:d.left,y:d.top,w:d.right-d.left,h:d.bottom-d.top},!t&&(a=o._rect,s=i,a&&s&&a.x===s.x&&a.y===s.y&&a.w===s.w&&a.h===s.h)||(o._rect=i,u.data=function(t,r){var n=t.key||"",i=t.tree||[],a=t.groups||[],s=a.length,o=(t.spacing||0)+(t.borderWidth||0);return!i.length&&t.data.length&&(i=t.tree=t.data),s?function t(r,h,u,l){var d,c=a[r],m=r>0&&a[r-1],g=p(e.group(i,c,n,m,u),h,n,c,r,l),f=g.slice();return r<s-1&&g.forEach(function(e){d={x:e.x+o,y:e.y+o,w:e.w-2*o,h:e.h-2*o},e.h>25&&(d.y+=15,d.h-=15),f.push.apply(f,t(r+1,d,e.g,e.s))}),f}(0,r):p(i,r,n)}(u,i),o.resyncElements()),r=0,n=l.length;r<n;++r)o.updateElement(l[r],r,t)},updateElement:function(t,e,r){var n=this.index,i=this.getDataset().data[e],a=this._resolveElementOptions(t,e),s=r?0:i.h-2*a.spacing,o=r?0:i.w-2*a.spacing,h=i.x+o/2+a.spacing,u=i.y+s/2+a.spacing,l=s/2;t._options=a,t._datasetIndex=n,t._index=e,t.hidden=s<=a.spacing||o<=a.spacing,t._model={x:h,base:u-l,y:u+l,top:i.y,left:i.x,width:o,height:s,backgroundColor:a.backgroundColor,borderColor:a.borderColor,borderSkipped:a.borderSkipped,borderWidth:a.borderWidth},t.pivot()},draw:function(){var t,e,r,n,i,a=this.getMeta().data||[],s=this.getDataset(),o=(s.groups||[]).length-1,h=s.data||[],u=this.chart.ctx;for(t=0,e=a.length;t<e;++t)i=(r=a[t])._view,n=h[t],r.hidden||(r.draw(),i.height>25&&n.g&&(u.save(),u.fillStyle="#000",u.font="12px serif",u.beginPath(),u.rect(i.left,i.top,i.width,i.height),u.clip(),"l"in n&&n.l!==o?(u.textAlign="start",u.textBaseline="top",u.fillText(n.g,i.left+i.borderWidth+3,i.top+i.borderWidth+3)):(u.textAlign="center",u.textBaseline="middle",u.fillText(n.g,i.left+i.width/2,i.top+i.height/2)),u.restore()))},_resolveElementOptions:function(t,e){var r,n,i,a=this.chart,s=this.getDataset(),o=a.options.elements.rectangle,h={},u={chart:a,dataIndex:e,dataset:s,datasetIndex:this.index},l=["backgroundColor","borderColor","borderSkipped","borderWidth","spacing"];for(r=0,n=l.length;r<n;++r)h[i=l[r]]=c([s[i],o[i]],u,e);return h}});t.controllers.treemap=m,t.defaults.treemap={hover:{mode:"nearest",intersect:!0},tooltips:{mode:"nearest",position:"treemap",intersect:!0},scales:{xAxes:[{type:"linear",display:!1}],yAxes:[{type:"linear",display:!1}]},elements:{rectangle:{borderSkipped:!1,borderWidth:0,spacing:.5}}},t.Tooltip.positioners.treemap=function(t){if(!t.length)return!1;var e=t[0]._view;return{x:e.x,y:e.y-e.height/2}}});
