/*!
 * chartjs-chart-treemap v1.0.0-alpha
 * https://github.com/kurkle/chartjs-chart-treemap#readme
 * (c) 2020 Jukka Kurkela
 * Released under the MIT license
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("chart.js")):"function"==typeof define&&define.amd?define(["chart.js"],e):e((t=t||self).Chart)}(this,(function(t){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}function o(){return(o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function f(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function s(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function c(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?s(t):e}function h(t){return function(){var e,n=u(t);if(f()){var r=u(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return c(this,e)}}function p(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,i=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==u.return||u.return()}finally{if(i)throw o}}return n}(t,e)||d(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t){return function(t){if(Array.isArray(t))return g(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||d(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(t,e){if(t){if("string"==typeof t)return g(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(t,e):void 0}}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function m(t,n){var r,i=t.length;if(!i)return n;var o=function(t){var n=e(t);return"function"===n||"object"===n&&!!t}(t[0]);for(n=o?n:"v",r=0,i=t.length;r<i;++r)o?t[r]._idx=r:t[r]={v:t[r],_idx:r};return n}function v(t,e){return+(Math.round(t+"e+"+e)+"e-"+e)}function b(t,e,n,r){var i=t._normalized,o=e*i/n,a=Math.sqrt(i*o),u=i/a;return{d1:a,d2:u,w:"_ix"===r?a:u,h:"_ix"===r?u:a}}function x(t,e,n,r){var i={x:v(t.x+t._ix,4),y:v(t.y+t._iy,4),w:v(n.w,4),h:v(n.h,4),a:e._normalized,v:e.value,s:r,_data:e._data};return e.group&&(i.g=e.group,i.l=e.level,i.gs=e.groupSum),i}t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;var w=function(){function t(e){n(this,t);var r=this;r.x=e.x||e.left||0,r.y=e.y||e.top||0,r._ix=0,r._iy=0,r.w=e.w||e.width||e.right-e.left,r.h=e.h||e.height||e.bottom-e.top}return i(t,[{key:"map",value:function(t){var e,n,r,i=this,o=[],a=t.nsum,u=t.get(),l=u.length,f=i.dir,s=i.side,c=s*s,h="x"===f?"_ix":"_iy",p=a*a,y=0,d=0;for(e=0;e<l;++e)d+=(r=b(n=u[e],c,p,h)).d1,r.d2>y&&(y=r.d2),o.push(x(i,n,r,t.sum)),i[h]+=r.d1;return i["y"===f?"_ix":"_iy"]+=y,i[h]-=d,o}},{key:"area",get:function(){return this.w*this.h}},{key:"iw",get:function(){return this.w-this._ix}},{key:"ih",get:function(){return this.h-this._iy}},{key:"dir",get:function(){var t=this.ih;return t<=this.iw&&t>0?"y":"x"}},{key:"side",get:function(){return"x"===this.dir?this.iw:this.ih}}]),t}(),_=Math.min,k=Math.max;function S(t){return{min:t.min,max:t.max,sum:t.sum,nmin:t.nmin,nmax:t.nmax,nsum:t.nsum}}function O(t,e){var n=+e[t.key],r=n*t.ratio;return e._normalized=r,{min:_(t.min,n),max:k(t.max,n),sum:t.sum+n,nmin:_(t.nmin,r),nmax:k(t.nmax,r),nsum:t.nsum+r}}function j(t,e,n){t._arr.push(e),function(t,e){o(t,e)}(t,n)}var A=function(){function t(e,r){n(this,t);this.key=e,this.ratio=r,this.reset()}return i(t,[{key:"reset",value:function(){var t=this;t._arr=[],t._hist=[],t.sum=0,t.nsum=0,t.min=1/0,t.max=-1/0,t.nmin=1/0,t.nmax=-1/0}},{key:"push",value:function(t){j(this,t,O(this,t))}},{key:"pushIf",value:function(t,e){for(var n=O(this,t),r=arguments.length,i=new Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];if(!e(S(this),n,i))return t;j(this,t,n)}},{key:"get",value:function(){return this._arr}},{key:"length",get:function(){return this._arr.length}}]),t}();function C(t,e,n){if(0===t.sum)return!0;var r=p(n,1)[0],i=t.nsum*t.nsum,o=e.nsum*e.nsum,a=r*r,u=Math.max(a*t.nmax/i,i/(a*t.nmin));return Math.max(a*e.nmax/o,o/(a*e.nmin))<=u}function E(t,e,n,r,i,o){var a,u,l=[],f=new w(e),s=new A("value",f.area/function(t,e){var n,r,i;for(n=0,r=0,i=t.length;r<i;++r)n+=e?+t[r][e]:+t[r];return n}(t,n)),c=f.side,h=t.length;if(!h)return l;var p,d=t.slice();function g(t){return r&&d[t][r]}for(n=m(d,n),function(t,e){e?t.sort((function(t,n){return+n[e]-+t[e]})):t.sort((function(t,e){return+e-+t}))}(d,n),a=0;a<h;++a)u={value:(p=a,n?+d[p][n]:+d[p]),groupSum:o,_data:t[d[a]._idx]},r&&(u.level=i,u.group=g(a)),(u=s.pushIf(u,C,c))&&(l.push(f.map(s)),c=f.side,s.reset(),s.push(u));return s.length&&l.push(f.map(s)),function(t){for(var e=y(t),n=[];e.length;){var r=e.pop();Array.isArray(r)?e.push.apply(e,y(r)):n.push(r)}return n.reverse()}(l)}function P(t,e){var n=t.getProps(["x","y","width","height"],e),r=n.x,i=n.y;return{left:r,top:i,right:r+n.width,bottom:i+n.height}}function M(t,e,n){return Math.max(Math.min(t,n),e)}function R(e){var n=P(e),r=n.right-n.left,i=n.bottom-n.top,o=function(e,n,r){var i,o,a,u,l=e.options.borderWidth;return t.helpers.isObject(l)?(i=+l.top||0,o=+l.right||0,a=+l.bottom||0,u=+l.left||0):i=o=a=u=+l||0,{t:M(i,0,r),r:M(o,0,n),b:M(a,0,r),l:M(u,0,n)}}(e,r/2,i/2);return{outer:{x:n.left,y:n.top,w:r,h:i},inner:{x:n.left+o.l,y:n.top+o.t,w:r-o.l-o.r,h:i-o.t-o.b}}}function D(t,e,n,r){var i=null===e,o=null===n,a=!(!t||i&&o)&&P(t,r);return a&&(i||e>=a.left&&e<=a.right)&&(o||n>=a.top&&n<=a.bottom)}var I,z,T,H=function(t){a(r,t);var e=h(r);function r(t){var i;return n(this,r),(i=e.call(this)).options=void 0,i.width=void 0,i.height=void 0,t&&o(s(i),t),i}return i(r,[{key:"draw",value:function(t){var e=this.options,n=R(this),r=n.inner,i=n.outer;t.save(),i.w!==r.w||i.h!==r.h?(t.beginPath(),t.rect(i.x,i.y,i.w,i.h),t.clip(),t.rect(r.x,r.y,r.w,r.h),t.fillStyle=e.backgroundColor,t.fill(),t.fillStyle=e.borderColor,t.fill("evenodd")):(t.fillStyle=e.backgroundColor,t.fillRect(r.x,r.y,r.w,r.h)),t.restore()}},{key:"inRange",value:function(t,e,n){return D(this,t,e,n)}},{key:"inXRange",value:function(t,e){return D(this,t,null,e)}},{key:"inYRange",value:function(t,e){return D(this,null,t,e)}},{key:"getCenterPoint",value:function(t){var e=this.getProps(["x","y","width","height"],t),n=e.x,r=e.y;return{x:n+e.width/2,y:r+e.height/2}}},{key:"tooltipPosition",value:function(){return this.getCenterPoint()}},{key:"getRange",value:function(t){return"x"===t?this.width/2:this.height/2}}]),r}(t.Element);T="rectangle",(z="_type")in(I=H)?Object.defineProperty(I,z,{value:T,enumerable:!0,configurable:!0,writable:!0}):I[z]=T;var W=t.defaults,F=t.helpers,q=F.options,B=q._parseFont,U=q.resolve,X=F.valueOrDefault;function Y(t,e){var n=t.width||t.w,r=t.height||t.h,i=2*e.lineHeight;return n>i&&r>i}function $(t,e,n){var r=t.key||"",i=t.tree||[],o=t.groups||[],a=o.length,u=(t.spacing||0)+(t.borderWidth||0);return!i.length&&t.data.length&&(i=t.tree=t.data),a?function t(e,l,f,s){var c,h=o[e],p=e>0&&o[e-1],d=E(function(t,e,n,r,i){var o,a,u,l,f=Object.create(null),s=Object.create(null),c=[];for(a=0,u=t.length;a<u;++a)l=t[a],r&&l[r]!==i||((o=l[e]||"")in f||(f[o]=0,s[o]=[]),f[o]+=+l[n],s[o].push(l));return Object.keys(f).forEach((function(t){(l={children:s[t]})[n]=+f[t],l[e]=t,r&&(l[r]=i),c.push(l)})),c}(i,h,r,p,f),l,r,h,e,s),g=d.slice();return e<a-1&&d.forEach((function(r){c={x:r.x+u,y:r.y+u,w:r.w-2*u,h:r.h-2*u},Y(r,n)&&(c.y+=n.lineHeight,c.h-=n.lineHeight),g.push.apply(g,y(t(e+1,c,r.g,r.s)))})),g}(0,e):E(i,e,r)}var G=function(t){a(r,t);var e=h(r);function r(){return n(this,r),e.apply(this,arguments)}return i(r,[{key:"update",value:function(t){var e,n,r,i=this,a=i.getMeta(),u=i.getDataset(),l=u.groups||(u.groups=[]),f=o(B({fontFamily:X((e=u).fontFamily,W.fontFamily),fontSize:X(e.fontSize,W.fontSize),fontStyle:X(e.fontStyle,W.fontStyle),lineHeight:X(e.lineHeight,W.lineHeight)}),{color:U([e.fontColor,W.fontColor])}),s=i.chart.chartArea,c=u.key||"",h={x:s.left,y:s.top,w:s.right-s.left,h:s.bottom-s.top};"reset"!==t&&(n=i._rect,r=h,n&&r&&n.x===r.x&&n.y===r.y&&n.w===r.w&&n.h===r.h)&&i._key===c&&!function(t,e){var n,r;if(t.lenght!==e.length)return!0;for(n=0,r=t.length;n<r;++n)if(t[n]!==e[n])return!0;return!1}(i._groups,l)||(i._rect=h,i._groups=l.slice(),i._key=c,u.data=$(u,h,f),i._dataCheck(),i._resyncElements()),i.updateElements(a.data,0,t)}},{key:"updateElements",value:function(t,e,n){for(var r=this,i="reset"===n,o=r.getDataset(),a=r.resolveDataElementOptions(e,n),u=r.getSharedOptions(n,t[e],a),l=0;l<t.length;l++){var f=e+l,s=o.data[f],c=r.resolveDataElementOptions(l,n),h=i?0:s.h-2*c.spacing,p=i?0:s.w-2*c.spacing,y={x:s.x+c.spacing,y:s.y+c.spacing,width:p,height:h,options:c};c.font=B(c),r.updateElement(t[l],f,y,n)}r.updateSharedOptions(u,n)}},{key:"draw",value:function(){var t,e,n,r,i=this.getMeta().data||[],o=this.getDataset(),a=(o.groups||[]).length-1,u=o.data||[],l=this.chart.ctx;for(t=0,e=i.length;t<e;++t)if(n=i[t],r=u[t],!n.hidden){n.draw(l);var f=n.options;Y(n,f.font)&&r.g&&(l.save(),l.fillStyle=f.fontColor,l.font=f.font.string,l.beginPath(),l.rect(n.x,n.y,n.width,n.height),l.clip(),"l"in r&&r.l!==a?(l.textAlign="start",l.textBaseline="top",l.fillText(r.g,n.x+f.borderWidth+3,n.y+f.borderWidth+3)):(l.textAlign="center",l.textBaseline="middle",l.fillText(r.g,n.x+n.width/2,n.y+n.height/2)),l.restore())}}}]),r}(t.DatasetController);G.prototype.dataElementType=H,G.prototype.dataElementOptions=["backgroundColor","borderColor","borderSkipped","borderWidth","fontColor","fontFamily","fontSize","fontStyle","spacing"];t.controllers.treemap=G,t.defaults.treemap={hover:{mode:"point",intersect:!0},tooltips:{mode:"point",position:"treemap",intersect:!0,callbacks:{title:function(t,e){return e.datasets[t[0].datasetIndex].key},label:function(t,e){var n=e.datasets[t.datasetIndex],r=n.data[t.index];return n.label+": "+r.v}}},scales:{x:{type:"linear",display:!1},y:{type:"linear",display:!1}},elements:{rectangle:{borderWidth:0,spacing:.5}}},t.plugins.getAll().find((function(t){return"tooltip"===t.id})).positioners.treemap=function(t){if(!t.length)return!1;var e=t[t.length-1].element;return{x:e.x+e.width/2,y:e.y+e.height/2}}}));
