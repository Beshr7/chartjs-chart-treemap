/*!
 * chartjs-chart-treemap v0.2.1
 * https://github.com/kurkle/chartjs-chart-treemap#readme
 * (c) 2019 Jukka Kurkela
 * Released under the MIT license
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("chart.js")):"function"==typeof define&&define.amd?define(["chart.js"],e):e((t=t||self).Chart)}(this,function(t){"use strict";function e(t){var e=typeof t;return"function"===e||"object"===e&&!!t}t=t&&t.hasOwnProperty("default")?t.default:t;var r={flatten:function(t){const e=[...t],r=[];for(;e.length;){const t=e.pop();Array.isArray(t)?e.push(...t):r.push(t)}return r.reverse()},group:function(t,e,r,n,i){var a,s,o,h,u=Object.create(null),l=Object.create(null),d=[];for(s=0,o=t.length;s<o;++s)h=t[s],n&&h[n]!==i||((a=h[e]||"")in u||(u[a]=0,l[a]=[]),u[a]+=+h[r],l[a].push(h));return Object.keys(u).forEach(function(t){(h={children:l[t]})[r]=+u[t],h[e]=t,n&&(h[n]=i),d.push(h)}),d},index:function(t,r){var n,i,a=t.length;if(!a)return r;for(r=(i=e(t[0]))?r:"v",n=0,a=t.length;n<a;++n)i?t[n]._idx=n:t[n]={v:t[n],_idx:n};return r},isObject:e,sort:function(t,e){e?t.sort(function(t,r){return+r[e]-+t[e]}):t.sort(function(t,e){return+e-+t})},sum:function(t,e){var r,n,i;for(r=0,n=0,i=t.length;n<i;++n)r+=e?+t[n][e]:+t[n];return r}};function n(t,e){return+(Math.round(t+"e+"+e)+"e-"+e)}function i(t,e,r,n){var i=t._normalized,a=e*i/r,s=Math.sqrt(i*a),o=i/s;return{d1:s,d2:o,w:"_ix"===n?s:o,h:"_ix"===n?o:s}}function a(t,e,r,i){var a={x:n(t.x+t._ix,4),y:n(t.y+t._iy,4),w:n(r.w,4),h:n(r.h,4),a:e._normalized,v:e.value,s:i,_data:e._data};return e.group&&(a.g=e.group,a.l=e.level,a.gs=e.groupSum),a}class s{constructor(t){var e=this;e.x=t.x||t.left||0,e.y=t.y||t.top||0,e._ix=0,e._iy=0,e.w=t.w||t.width||t.right-t.left,e.h=t.h||t.height||t.bottom-t.top}get area(){return this.w*this.h}get iw(){return this.w-this._ix}get ih(){return this.h-this._iy}get dir(){var t=this.ih;return t<=this.iw&&t>0?"y":"x"}get side(){return"x"===this.dir?this.iw:this.ih}map(t){var e,r,n,s=this,o=[],h=t.nsum,u=t.get(),l=u.length,d=s.dir,p=s.side,c=p*p,g="x"===d?"_ix":"_iy",f=h*h,m=0,x=0;for(e=0;e<l;++e)x+=(n=i(r=u[e],c,f,g)).d1,n.d2>m&&(m=n.d2),o.push(a(s,r,n,t.sum)),s[g]+=n.d1;return s["y"===d?"_ix":"_iy"]+=m,s[g]-=x,o}}const o=Math.min,h=Math.max;function u(t,e){var r=+e[t.key],n=r*t.ratio;return e._normalized=n,{min:o(t.min,r),max:h(t.max,r),sum:t.sum+r,nmin:o(t.nmin,n),nmax:h(t.nmax,n),nsum:t.nsum+n}}function l(t,e,r){t._arr.push(e),function(t,e){Object.assign(t,e)}(t,r)}class d{constructor(t,e){this.key=t,this.ratio=e,this.reset()}get length(){return this._arr.length}reset(){var t=this;t._arr=[],t._hist=[],t.sum=0,t.nsum=0,t.min=1/0,t.max=-1/0,t.nmin=1/0,t.nmax=-1/0}push(t){l(this,t,u(this,t))}pushIf(t,e,...r){var n,i=u(this,t);if(!e((n=this,{min:n.min,max:n.max,sum:n.sum,nmin:n.nmin,nmax:n.nmax,nsum:n.nsum}),i,r))return t;l(this,t,i)}get(){return this._arr}}function p(t,e,r){if(0===t.sum)return!0;var[n]=r,i=t.nsum*t.nsum,a=e.nsum*e.nsum,s=n*n,o=Math.max(s*t.nmax/i,i/(s*t.nmin));return Math.max(s*e.nmax/a,a/(s*e.nmin))<=o}function c(t,e,n,i,a,o){var h,u,l,c,g=r.sum(t,n),f=[],m=new s(e),x=new d("value",m.area/g),y=m.side,v=t.length;if(!v)return f;function _(t){return i&&l[t][i]}for(l=t.slice(),n=r.index(l,n),r.sort(l,n),h=0;h<v;++h)u={value:(c=h,n?+l[c][n]:+l[c]),groupSum:o,_data:t[l[h]._idx]},i&&(u.level=a,u.group=_(h)),(u=x.pushIf(u,p,y))&&(f.push(m.map(x)),y=m.side,x.reset(),x.push(u));return x.length&&f.push(m.map(x)),r.flatten(f)}var g=t.helpers.options.resolve;var f=t.DatasetController.extend({dataElementType:t.elements.Rectangle,update:function(t){var e,n,i,a,s,o=this,h=o.getMeta(),u=o.getDataset(),l=u.groups||(u.groups=[]),d=h.data||[],p=o.chart.chartArea,g=u.key||"";for(i={x:p.left,y:p.top,w:p.right-p.left,h:p.bottom-p.top},!t&&(a=o._rect,s=i,a&&s&&a.x===s.x&&a.y===s.y&&a.w===s.w&&a.h===s.h)&&o._key===g&&!function(t,e){var r,n;if(t.lenght!==e.length)return!0;for(r=0,n=t.length;r<n;++r)if(t[r]!==e[r])return!0;return!1}(o._groups,l)||(o._rect=i,o._groups=l.slice(),o._key=g,u.data=function(t,e){var n=t.key||"",i=t.tree||[],a=t.groups||[],s=a.length,o=(t.spacing||0)+(t.borderWidth||0);return!i.length&&t.data.length&&(i=t.tree=t.data),s?function t(e,h,u,l){var d,p=a[e],g=e>0&&a[e-1],f=c(r.group(i,p,n,g,u),h,n,p,e,l),m=f.slice();return e<s-1&&f.forEach(function(r){d={x:r.x+o,y:r.y+o,w:r.w-2*o,h:r.h-2*o},r.h>25&&(d.y+=15,d.h-=15),m.push.apply(m,t(e+1,d,r.g,r.s))}),m}(0,e):c(i,e,n)}(u,i),o.resyncElements()),e=0,n=d.length;e<n;++e)o.updateElement(d[e],e,t)},updateElement:function(t,e,r){var n=this.index,i=this.getDataset().data[e],a=this._resolveElementOptions(t,e),s=r?0:i.h-2*a.spacing,o=r?0:i.w-2*a.spacing,h=i.x+o/2+a.spacing,u=i.y+s/2+a.spacing,l=s/2;t._options=a,t._datasetIndex=n,t._index=e,t.hidden=s<=a.spacing||o<=a.spacing,t._model={x:h,base:u-l,y:u+l,top:i.y,left:i.x,width:o,height:s,backgroundColor:a.backgroundColor,borderColor:a.borderColor,borderSkipped:a.borderSkipped,borderWidth:a.borderWidth},t.pivot()},draw:function(){var t,e,r,n,i,a=this.getMeta().data||[],s=this.getDataset(),o=(s.groups||[]).length-1,h=s.data||[],u=this.chart.ctx;for(t=0,e=a.length;t<e;++t)i=(r=a[t])._view,n=h[t],r.hidden||(r.draw(),i.height>25&&n.g&&(u.save(),u.fillStyle="#000",u.font="12px serif",u.beginPath(),u.rect(i.left,i.top,i.width,i.height),u.clip(),"l"in n&&n.l!==o?(u.textAlign="start",u.textBaseline="top",u.fillText(n.g,i.left+i.borderWidth+3,i.top+i.borderWidth+3)):(u.textAlign="center",u.textBaseline="middle",u.fillText(n.g,i.left+i.width/2,i.top+i.height/2)),u.restore()))},_resolveElementOptions:function(t,e){var r,n,i,a=this.chart,s=this.getDataset(),o=a.options.elements.rectangle,h={},u={chart:a,dataIndex:e,dataset:s,datasetIndex:this.index},l=["backgroundColor","borderColor","borderSkipped","borderWidth","spacing"];for(r=0,n=l.length;r<n;++r)h[i=l[r]]=g([s[i],o[i]],u,e);return h}});t.controllers.treemap=f,t.defaults.treemap={hover:{mode:"nearest",intersect:!0},tooltips:{mode:"nearest",position:"treemap",intersect:!0},scales:{xAxes:[{type:"linear",display:!1}],yAxes:[{type:"linear",display:!1}]},elements:{rectangle:{borderSkipped:!1,borderWidth:0,spacing:.5}}},t.Tooltip.positioners.treemap=function(t){if(!t.length)return!1;var e=t[0]._view;return{x:e.x,y:e.y-e.height/2}}});
