/*!
 * chartjs-chart-treemap v1.0.0-alpha
 * https://github.com/kurkle/chartjs-chart-treemap#readme
 * (c) 2020 Jukka Kurkela
 * Released under the MIT license
 */
import t from"chart.js";function e(){return(e=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t}).apply(this,arguments)}function r(t,e){return+(Math.round(t+"e+"+e)+"e-"+e)}function n(t,e,r,n){var i=t._normalized,a=e*i/r,o=Math.sqrt(i*a),s=i/o;return{d1:o,d2:s,w:"_ix"===n?o:s,h:"_ix"===n?s:o}}function i(t,e,n,i){var a={x:r(t.x+t._ix,4),y:r(t.y+t._iy,4),w:r(n.w,4),h:r(n.h,4),a:e._normalized,v:e.value,s:i,_data:e._data};return e.group&&(a.g=e.group,a.l=e.level,a.gs=e.groupSum),a}class a{constructor(t){var e=this;e.x=t.x||t.left||0,e.y=t.y||t.top||0,e._ix=0,e._iy=0,e.w=t.w||t.width||t.right-t.left,e.h=t.h||t.height||t.bottom-t.top}get area(){return this.w*this.h}get iw(){return this.w-this._ix}get ih(){return this.h-this._iy}get dir(){var t=this.ih;return t<=this.iw&&t>0?"y":"x"}get side(){return"x"===this.dir?this.iw:this.ih}map(t){var e,r,a,o=this,s=[],h=t.nsum,l=t.get(),u=l.length,g=o.dir,d=o.side,p=d*d,f="x"===g?"_ix":"_iy",c=h*h,m=0,y=0;for(e=0;e<u;++e)y+=(a=n(r=l[e],p,c,f)).d1,a.d2>m&&(m=a.d2),s.push(i(o,r,a,t.sum)),o[f]+=a.d1;return o["y"===g?"_ix":"_iy"]+=m,o[f]-=y,s}}var o,s,h,l=Math.min,u=Math.max;function g(t,e){var r=+e[t.key],n=r*t.ratio;return e._normalized=n,{min:l(t.min,r),max:u(t.max,r),sum:t.sum+r,nmin:l(t.nmin,n),nmax:u(t.nmax,n),nsum:t.nsum+n}}function d(t,r,n){t._arr.push(r),function(t,r){e(t,r)}(t,n)}class p{constructor(t,e){this.key=t,this.ratio=e,this.reset()}get length(){return this._arr.length}reset(){var t=this;t._arr=[],t._hist=[],t.sum=0,t.nsum=0,t.min=1/0,t.max=-1/0,t.nmin=1/0,t.nmax=-1/0}push(t){d(this,t,g(this,t))}pushIf(t,e){for(var r,n=g(this,t),i=arguments.length,a=new Array(i>2?i-2:0),o=2;o<i;o++)a[o-2]=arguments[o];if(!e((r=this,{min:r.min,max:r.max,sum:r.sum,nmin:r.nmin,nmax:r.nmax,nsum:r.nsum}),n,a))return t;d(this,t,n)}get(){return this._arr}}function f(t,e,r){if(0===t.sum)return!0;var[n]=r,i=t.nsum*t.nsum,a=e.nsum*e.nsum,o=n*n,s=Math.max(o*t.nmax/i,i/(o*t.nmin));return Math.max(o*e.nmax/a,a/(o*e.nmin))<=s}function c(t,e,r,n,i,o){var s,h,l=[],u=new a(e),g=new p("value",u.area/function(t,e){var r,n,i;for(r=0,n=0,i=t.length;n<i;++n)r+=e?+t[n][e]:+t[n];return r}(t,r)),d=u.side,c=t.length;if(!c)return l;var m,y=t.slice();function x(t){return n&&y[t][n]}for(r=function(t,e){var r,n=t.length;if(!n)return e;var i=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t}(t[0]);for(e=i?e:"v",r=0,n=t.length;r<n;++r)i?t[r]._idx=r:t[r]={v:t[r],_idx:r};return e}(y,r),function(t,e){e?t.sort((t,r)=>+r[e]-+t[e]):t.sort((t,e)=>+e-+t)}(y,r),s=0;s<c;++s)h={value:(m=s,r?+y[m][r]:+y[m]),groupSum:o,_data:t[y[s]._idx]},n&&(h.level=i,h.group=x(s)),(h=g.pushIf(h,f,d))&&(l.push(u.map(g)),d=u.side,g.reset(),g.push(h));return g.length&&l.push(u.map(g)),function(t){for(var e=[...t],r=[];e.length;){var n=e.pop();Array.isArray(n)?e.push(...n):r.push(n)}return r.reverse()}(l)}function m(t,e){var{x:r,y:n,width:i,height:a}=t.getProps(["x","y","width","height"],e);return{left:r,top:n,right:r+i,bottom:n+a}}function y(t,e,r){return Math.max(Math.min(t,r),e)}function x(e){var r=m(e),n=r.right-r.left,i=r.bottom-r.top,a=function(e,r,n){var i,a,o,s,h=e.options.borderWidth;return t.helpers.isObject(h)?(i=+h.top||0,a=+h.right||0,o=+h.bottom||0,s=+h.left||0):i=a=o=s=+h||0,{t:y(i,0,n),r:y(a,0,r),b:y(o,0,n),l:y(s,0,r)}}(e,n/2,i/2);return{outer:{x:r.left,y:r.top,w:n,h:i},inner:{x:r.left+a.l,y:r.top+a.t,w:n-a.l-a.r,h:i-a.t-a.b}}}function v(t,e,r,n){var i=null===e,a=null===r,o=!(!t||i&&a)&&m(t,n);return o&&(i||e>=o.left&&e<=o.right)&&(a||r>=o.top&&r<=o.bottom)}class w extends t.Element{constructor(t){super(),this.options=void 0,this.width=void 0,this.height=void 0,t&&e(this,t)}draw(t){var e=this.options,{inner:r,outer:n}=x(this);t.save(),n.w!==r.w||n.h!==r.h?(t.beginPath(),t.rect(n.x,n.y,n.w,n.h),t.clip(),t.rect(r.x,r.y,r.w,r.h),t.fillStyle=e.backgroundColor,t.fill(),t.fillStyle=e.borderColor,t.fill("evenodd")):(t.fillStyle=e.backgroundColor,t.fillRect(r.x,r.y,r.w,r.h)),t.restore()}inRange(t,e,r){return v(this,t,e,r)}inXRange(t,e){return v(this,t,null,e)}inYRange(t,e){return v(this,null,t,e)}getCenterPoint(t){var{x:e,y:r,width:n,height:i}=this.getProps(["x","y","width","height"],t);return{x:e+n/2,y:r+i/2}}tooltipPosition(){return this.getCenterPoint()}getRange(t){return"x"===t?this.width/2:this.height/2}}h="rectangle",(s="_type")in(o=w)?Object.defineProperty(o,s,{value:h,enumerable:!0,configurable:!0,writable:!0}):o[s]=h;var b=t.defaults,_=t.helpers,S=_.options,k=S._parseFont,O=S.resolve,C=_.valueOrDefault;function E(t,e){var r=t.width||t.w,n=t.height||t.h,i=2*e.lineHeight;return r>i&&n>i}function M(t,e,r){var n=t.key||"",i=t.tree||[],a=t.groups||[],o=a.length,s=(t.spacing||0)+(t.borderWidth||0);return!i.length&&t.data.length&&(i=t.tree=t.data),o?function t(e,h,l,u){var g,d=a[e],p=e>0&&a[e-1],f=c(function(t,e,r,n,i){var a,o,s,h,l=Object.create(null),u=Object.create(null),g=[];for(o=0,s=t.length;o<s;++o)h=t[o],n&&h[n]!==i||((a=h[e]||"")in l||(l[a]=0,u[a]=[]),l[a]+=+h[r],u[a].push(h));return Object.keys(l).forEach(t=>{(h={children:u[t]})[r]=+l[t],h[e]=t,n&&(h[n]=i),g.push(h)}),g}(i,d,n,p,l),h,n,d,e,u),m=f.slice();return e<o-1&&f.forEach(n=>{g={x:n.x+s,y:n.y+s,w:n.w-2*s,h:n.h-2*s},E(n,r)&&(g.y+=r.lineHeight,g.h-=r.lineHeight),m.push(...t(e+1,g,n.g,n.s))}),m}(0,e):c(i,e,n)}class j extends t.DatasetController{update(t){var r,n,i,a=this,o=a.getMeta(),s=a.getDataset(),h=s.groups||(s.groups=[]),l=e(k({fontFamily:C((r=s).fontFamily,b.fontFamily),fontSize:C(r.fontSize,b.fontSize),fontStyle:C(r.fontStyle,b.fontStyle),lineHeight:C(r.lineHeight,b.lineHeight)}),{color:O([r.fontColor,b.fontColor])}),u=a.chart.chartArea,g=s.key||"",d={x:u.left,y:u.top,w:u.right-u.left,h:u.bottom-u.top};"reset"!==t&&(n=a._rect,i=d,n&&i&&n.x===i.x&&n.y===i.y&&n.w===i.w&&n.h===i.h)&&a._key===g&&!function(t,e){var r,n;if(t.lenght!==e.length)return!0;for(r=0,n=t.length;r<n;++r)if(t[r]!==e[r])return!0;return!1}(a._groups,h)||(a._rect=d,a._groups=h.slice(),a._key=g,s.data=M(s,d,l),a._dataCheck(),a._resyncElements()),a.updateElements(o.data,0,t)}updateElements(t,e,r){for(var n=this,i="reset"===r,a=n.getDataset(),o=n.resolveDataElementOptions(e,r),s=n.getSharedOptions(r,t[e],o),h=0;h<t.length;h++){var l=e+h,u=a.data[l],g=n.resolveDataElementOptions(h,r),d=i?0:u.h-2*g.spacing,p=i?0:u.w-2*g.spacing,f={x:u.x+g.spacing,y:u.y+g.spacing,width:p,height:d,options:g};g.font=k(g),n.updateElement(t[h],l,f,r)}n.updateSharedOptions(s,r)}draw(){var t,e,r,n,i=this.getMeta().data||[],a=this.getDataset(),o=(a.groups||[]).length-1,s=a.data||[],h=this.chart.ctx;for(t=0,e=i.length;t<e;++t)if(r=i[t],n=s[t],!r.hidden){r.draw(h);var l=r.options;E(r,l.font)&&n.g&&(h.save(),h.fillStyle=l.fontColor,h.font=l.font.string,h.beginPath(),h.rect(r.x,r.y,r.width,r.height),h.clip(),"l"in n&&n.l!==o?(h.textAlign="start",h.textBaseline="top",h.fillText(n.g,r.x+l.borderWidth+3,r.y+l.borderWidth+3)):(h.textAlign="center",h.textBaseline="middle",h.fillText(n.g,r.x+r.width/2,r.y+r.height/2)),h.restore())}}}j.prototype.dataElementType=w,j.prototype.dataElementOptions=["backgroundColor","borderColor","borderSkipped","borderWidth","fontColor","fontFamily","fontSize","fontStyle","spacing"];var P={hover:{mode:"point",intersect:!0},tooltips:{mode:"point",position:"treemap",intersect:!0,callbacks:{title:(t,e)=>e.datasets[t[0].datasetIndex].key,label(t,e){var r=e.datasets[t.datasetIndex],n=r.data[t.index];return r.label+": "+n.v}}},scales:{x:{type:"linear",display:!1},y:{type:"linear",display:!1}},elements:{rectangle:{borderWidth:0,spacing:.5}}};t.controllers.treemap=j,t.defaults.treemap=P,t.plugins.getAll().find(t=>"tooltip"===t.id).positioners.treemap=function(t){if(!t.length)return!1;var e=t[t.length-1].element;return{x:e.x+e.width/2,y:e.y+e.height/2}};
